#!/usr/bin/execlineb -S0

devId=$(bashio::config 'devId')

bashio::log.info "Detaching $devId"

exec /usr/lib/linux-tools/$(uname -r)/usbip detach \
      --port=$(/usr/lib/linux-tools/$(uname -r)/usbip port | \
      grep '<Port in Use>' | sed -E 's/^Port ([0-9][0-9]).*/\\1/')

bashio::log.debug "Detatched $devId"

if { s6-test ${1} -ne 0 }
if { s6-test ${1} -ne 256 }

s6-svscanctl -t /var/run/s6/services